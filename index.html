<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Parcelninja PWA</title>
  <meta name="description" content="Testing PWA">
  <meta name="author" content="David Thompson">

  <script>
    if (navigator.serviceWorker.controller) {
      console.log('[PWA Builder] active service worker found, no need to register')
    } else {
      //Register the ServiceWorker
      navigator.serviceWorker.register('pwabuider-sw.js', {
        scope: './'
      }).then(function(reg) {
        console.log('Service worker has been registered for scope:'+ reg.scope);
      });
    }
  </script>
</head>

<body>
    <video id="player" controls autoplay></video>
    <button id="capture">Capture</button>
    <canvas id="canvas" width=320 height=240></canvas>
    <script>
      const player = document.getElementById('player');
      const canvas = document.getElementById('canvas');
      const context = canvas.getContext('2d');
      const captureButton = document.getElementById('capture');
    
      const constraints = {
        video: true,
      };
    
      captureButton.addEventListener('click', () => {
        // Draw the video frame to the canvas.
        context.drawImage(player, 0, 0, canvas.width, canvas.height);
      });
    
      // Attach the video stream to the video element and autoplay.
      navigator.mediaDevices.getUserMedia(constraints)
        .then((stream) => {
          player.srcObject = stream;
        });
    </script>

    <script>
        self.addEventListener('install', function(event) {
        var offlinePage = new Request('offline.html');
        event.waitUntil(
          fetch(offlinePage).then(function(response) {
            return caches.open('pwabuilder-offline').then(function(cache) {
              console.log('[PWA Builder] Cached offline page during Install'+ response.url);
              return cache.put(offlinePage, response);
            });
        }));
      });
    </script>
</body>
</html>